<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ChatYMS - v1.7</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            
            /* --- iOS Inspired Color Palette --- */
            /* Dark Mode Variables */
            --dm-bg-color: #000000;
            --dm-primary-element-bg: rgba(28, 28, 30, 0.85);
            --dm-secondary-element-bg: rgba(44, 44, 46, 0.78);
            --dm-tertiary-element-bg: rgba(58, 58, 60, 0.75);
            --dm-glass-border: rgba(80, 80, 85, 0.5);
            --dm-text-primary: #ffffff;
            --dm-text-secondary: #8e8e93;
            --dm-text-placeholder: #636366;
            --dm-accent-blue: #0A84FF;
            --dm-accent-green: #30D158;
            --dm-accent-red: #FF453A;
            --dm-user-bubble-bg: linear-gradient(135deg, var(--dm-accent-blue) 0%, #0060F0 100%);
            --dm-user-bubble-text: #ffffff;
            --dm-bot-bubble-bg: var(--dm-secondary-element-bg);
            --dm-bot-bubble-text: var(--dm-text-primary);
            --dm-button-hover-bg: rgba(120, 120, 128, 0.25);
            --dm-button-active-bg: rgba(120, 120, 128, 0.35);
            --dm-input-bg: var(--dm-tertiary-element-bg);
            --dm-input-focus-border: var(--dm-accent-blue);
            --dm-scrollbar-thumb: rgba(120, 120, 128, 0.5);
            --dm-markdown-code-bg: rgba(120,120,128,0.2);
            --dm-modal-overlay-bg: rgba(0,0,0,0.6);
            --dm-select-bg: var(--dm-secondary-element-bg); --dm-select-text: var(--dm-text-primary); --dm-select-border: var(--dm-glass-border);

            /* Light Mode Variables */
            --lm-bg-color: #f2f2f7;
            --lm-primary-element-bg: rgba(255, 255, 255, 0.85);
            --lm-secondary-element-bg: rgba(242, 242, 247, 0.8);
            --lm-tertiary-element-bg: rgba(229, 229, 234, 0.75);
            --lm-glass-border: rgba(60, 60, 67, 0.22);
            --lm-text-primary: #000000;
            --lm-text-secondary: #636366;
            --lm-text-placeholder: #aeaeb2;
            --lm-accent-blue: #007AFF;
            --lm-accent-green: #28CD41;
            --lm-accent-red: #FF3B30;
            --lm-user-bubble-bg: linear-gradient(135deg, var(--lm-accent-blue) 0%, #0056D0 100%);
            --lm-user-bubble-text: #ffffff;
            --lm-bot-bubble-bg: var(--lm-secondary-element-bg);
            --lm-bot-bubble-text: var(--lm-text-primary);
            --lm-button-hover-bg: rgba(174, 174, 178, 0.2);
            --lm-button-active-bg: rgba(174, 174, 178, 0.3);
            --lm-input-bg: var(--lm-tertiary-element-bg);
            --lm-input-focus-border: var(--lm-accent-blue);
            --lm-scrollbar-thumb: rgba(142, 142, 147, 0.6);
            --lm-markdown-code-bg: rgba(174,174,178,0.2);
            --lm-modal-overlay-bg: rgba(0,0,0,0.35);
            --lm-select-bg: var(--lm-secondary-element-bg); --lm-select-text: var(--lm-text-primary); --lm-select-border: var(--lm-glass-border);

            /* Mapped Variables */
            --current-bg-color: var(--dm-bg-color);
            --current-primary-element-bg: var(--dm-primary-element-bg); --current-secondary-element-bg: var(--dm-secondary-element-bg); --current-tertiary-element-bg: var(--dm-tertiary-element-bg);
            --current-glass-border: var(--dm-glass-border);
            --current-text-primary: var(--dm-text-primary); --current-text-secondary: var(--dm-text-secondary); --current-text-placeholder: var(--dm-text-placeholder); --current-header-text-color: var(--dm-text-primary);
            --current-accent-blue: var(--dm-accent-blue); --current-accent-green: var(--dm-accent-green); --current-accent-red: var(--dm-accent-red);
            --current-user-bubble-bg: var(--dm-user-bubble-bg); --current-user-bubble-text-color: var(--dm-user-bubble-text);
            --current-bot-bubble-bg: var(--dm-bot-bubble-bg); --current-bot-bubble-text-color: var(--dm-bot-bubble-text);
            --current-button-hover-bg: var(--dm-button-hover-bg); --current-button-active-bg: var(--dm-button-active-bg);
            --current-input-bg: var(--dm-input-bg); --current-input-focus-border: var(--dm-input-focus-border);
            --current-scrollbar-thumb-bg: var(--dm-scrollbar-thumb);
            --current-markdown-code-bg-color: var(--dm-markdown-code-bg);
            --current-modal-overlay-bg: var(--dm-modal-overlay-bg);
            --current-select-bg: var(--dm-select-bg); --current-select-text: var(--dm-select-text); --current-select-border: var(--dm-select-border);

            /* iOS-like Rounded Corners */
            --border-radius-xl: 38px; --border-radius-l: 22px; --border-radius-m: 12px; --border-radius-s: 8px; --border-radius-round: 50%;
        }

        body.light-mode {
            --current-bg-color: var(--lm-bg-color);
            --current-primary-element-bg: var(--lm-primary-element-bg); --current-secondary-element-bg: var(--lm-secondary-element-bg); --current-tertiary-element-bg: var(--lm-tertiary-element-bg);
            --current-glass-border: var(--lm-glass-border);
            --current-text-primary: var(--lm-text-primary); --current-text-secondary: var(--lm-text-secondary); --current-text-placeholder: var(--lm-text-placeholder); --current-header-text-color: var(--lm-text-primary);
            --current-accent-blue: var(--lm-accent-blue); --current-accent-green: var(--lm-accent-green); --current-accent-red: var(--lm-accent-red);
            --current-user-bubble-bg: var(--lm-user-bubble-bg); --current-user-bubble-text-color: var(--lm-user-bubble-text);
            --current-bot-bubble-bg: var(--lm-bot-bubble-bg); --current-bot-bubble-text-color: var(--lm-bot-bubble-text);
            --current-button-hover-bg: var(--lm-button-hover-bg); --current-button-active-bg: var(--lm-button-active-bg);
            --current-input-bg: var(--lm-input-bg); --current-input-focus-border: var(--lm-input-focus-border);
            --current-scrollbar-thumb-bg: var(--lm-scrollbar-thumb);
            --current-markdown-code-bg-color: var(--lm-markdown-code-bg);
            --current-modal-overlay-bg: var(--lm-modal-overlay-bg);
            --current-select-bg: var(--lm-select-bg); --current-select-text: var(--lm-select-text); --current-select-border: var(--lm-select-border);
        }

        /* General Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;}
        html { font-size: 16px; scroll-behavior: smooth; height: 100%; overflow: hidden;}
        body { font-family: var(--font-primary); background-color: var(--current-bg-color); color: var(--current-text-primary); display: flex; justify-content: center; align-items: center; height: 100%; padding: 0; overflow: hidden; transition: background-color 0.4s ease, color 0.4s ease; }

        /* Main Chat Container */
        #chatContainer { width: 100%; height: 100%; background-color: transparent; backdrop-filter: blur(25px) saturate(180%); -webkit-backdrop-filter: blur(25px) saturate(180%); display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        /* Header */
        header { padding: 10px 12px; background-color: transparent; border-bottom: 1px solid var(--current-glass-border); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; min-height: 54px; position: relative; z-index: 10; backdrop-filter: blur(25px) saturate(180%); -webkit-backdrop-filter: blur(25px) saturate(180%); }
        header .header-spacer { flex-basis: 44px; flex-shrink: 0;}
        header h1 { font-weight: 600; font-size: 1.1rem; color: var(--current-header-text-color); text-shadow: none; flex-grow: 1; text-align: center; margin: 0; }
        .header-controls { display: flex; align-items: center; gap: 4px; flex-basis: 44px; justify-content: flex-end; flex-shrink: 0;}

        /* Chatbox */
        #chatbox { flex-grow: 1; padding: 16px; padding-bottom: 80px; overflow-y: auto; -webkit-overflow-scrolling: touch; display: flex; flex-direction: column-reverse; /* New messages at the bottom */ }
        .chatbox-inner { display: flex; flex-direction: column; gap: 16px; }
        #chatbox::-webkit-scrollbar { width: 6px; }
        #chatbox::-webkit-scrollbar-thumb { background-color: var(--current-scrollbar-thumb-bg); border-radius: 3px; }

        /* Message Bubbles */
        .message-container { display: flex; flex-direction: column; animation: fadeInSlideUp 0.3s ease-out; }
        @keyframes fadeInSlideUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .message-content-wrapper { display: flex; align-items: flex-end; width: 100%; gap: 8px; }
        .user-message .message-content-wrapper { justify-content: flex-end; }
        .bot-message .message-content-wrapper { justify-content: flex-start; }
        .message-bubble { padding: 10px 14px; border-radius: var(--border-radius-l); max-width: 80%; line-height: 1.5; box-shadow: 0 1px 1px rgba(0,0,0,0.08); display: inline-block; text-align: left; overflow-wrap: anywhere; border: none; }
        .user-message .message-bubble { background: var(--current-user-bubble-bg); color: var(--current-user-bubble-text-color); }
        .message-container.user-message { align-items: flex-end; }
        .bot-message .message-bubble { background-color: var(--current-bot-bubble-bg); color: var(--current-bot-bubble-text-color); }
        .message-container.bot-message { align-items: flex-start; }
        .message-bubble.error-message { background-color: var(--current-accent-red) !important; color: #fff; }
        .timestamp { font-size: 0.7rem; color: var(--current-text-secondary); margin-top: 5px; padding: 0 8px; opacity: 0.9; }

        /* Copy Button */
        .copy-btn { background: none; border: none; color: var(--current-text-secondary); cursor: pointer; padding: 6px; opacity: 0.7; transition: opacity 0.2s, transform 0.2s; width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; border-radius: var(--border-radius-round); }
        .copy-btn svg { width: 16px; height: 16px; fill: currentColor; }
        .copy-btn:hover { opacity: 1; background-color: var(--current-button-hover-bg); }
        .copy-btn-copied svg { display: none; }
        .copy-btn-copied::before { content: '✓'; font-size: 1.1rem; font-weight: 600; color: var(--current-accent-green); }

        /* Typing Indicator */
        .typing-indicator-bubble { padding: 12px 16px !important; background-color: var(--current-bot-bubble-bg) !important; display: flex; align-items: center; border-color: var(--current-glass-border) !important;}
        .typing-dot { width: 8px; height: 8px; background-color: var(--current-bot-bubble-text-color); opacity: 0.7; border-radius: 50%; margin: 0 3px; animation: typingDotsiOS 1.2s infinite ease-in-out; }
        .typing-dot:nth-child(1) { animation-delay: -0.24s; } .typing-dot:nth-child(2) { animation-delay: -0.12s; }
        @keyframes typingDotsiOS { 0%, 60%, 100% { transform: scale(0.4); } 30% { transform: scale(1); } }

        /* Footer & Input Area */
        footer { padding: 8px 12px calc(8px + env(safe-area-inset-bottom)); border-top: 1px solid var(--current-glass-border); background-color: transparent; backdrop-filter: blur(25px) saturate(180%); -webkit-backdrop-filter: blur(25px) saturate(180%); flex-shrink: 0; position: relative; z-index: 10; }
        .input-area { display: flex; gap: 8px; align-items: center; background-color: var(--current-input-bg); border-radius: var(--border-radius-l); padding: 4px; overflow: hidden;}
        #userInput { flex-grow: 1; padding: 8px 10px; background-color: transparent; color: var(--current-text-input); font-size: 1rem; border: none; outline: none; resize: none; min-height: 36px; max-height: 120px; }
        #userInput::placeholder { color: var(--current-text-placeholder); }
        #sendMessage { background-color: var(--current-accent-blue); color: #fff; border: none; border-radius: var(--border-radius-round); width: 36px; height: 36px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; }
        #sendMessage svg { width: 18px; height: 18px; fill: #fff; }
        #sendMessage:active { transform: scale(0.9); }

        /* Icon Buttons */
        .icon-button { background: none; border: none; color: var(--current-accent-blue); padding: 0; border-radius: var(--border-radius-round); width: 38px; height: 38px; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: background-color 0.2s ease, transform 0.2s ease; }
        .icon-button:hover { background-color: var(--current-button-hover-bg); }
        .icon-button:active { background-color: var(--current-button-active-bg); transform: scale(0.92); }
        .icon-button svg { width: 22px; height: 22px; fill: currentColor; }

        /* Settings Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100dvh; background-color: var(--current-modal-overlay-bg); display: none; justify-content: center; align-items: flex-end; z-index: 2000; backdrop-filter: blur(10px) saturate(150%); -webkit-backdrop-filter: blur(10px) saturate(150%); transition: opacity 0.3s ease; }
        .modal-overlay.active { display: flex; opacity: 1; animation: fadeInOverlay 0.3s ease-out; }
        @keyframes fadeInOverlay { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background-color: var(--current-primary-element-bg); color: var(--current-text-primary); border-radius: var(--border-radius-l) var(--border-radius-l) 0 0; box-shadow: 0 -5px 25px rgba(0,0,0,0.15); width: 100%; max-width: 550px; border-top: 1px solid var(--current-glass-border); position: relative; animation: slideInModalFromBottom 0.35s cubic-bezier(0.25, 0.1, 0.25, 1); max-height: 90vh; display: flex; flex-direction: column; padding: 0; }
        @keyframes slideInModalFromBottom { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-header { display: flex; justify-content: center; align-items: center; padding: 16px; border-bottom: 1px solid var(--current-glass-border); flex-shrink: 0; position: relative; }
        .modal-header h2 { font-size: 1.1rem; font-weight: 600; color: var(--current-text-primary); margin:0; }
        .close-modal-btn { position: absolute; top: 50%; right: 12px; transform: translateY(-50%); }
        .close-modal-btn svg { width: 18px; height: 18px; }
        .settings-body { overflow-y: auto; flex-grow: 1; padding: 8px 16px 16px; }
        .settings-section { margin-bottom: 20px; background-color: var(--current-secondary-element-bg); border-radius: var(--border-radius-m); }
        .setting-item { display: flex; justify-content: space-between; align-items: center; min-height: 48px; border-bottom: 1px solid var(--current-glass-border); padding: 0 16px; }
        .settings-section .setting-item:last-child { border-bottom: none; }
        .setting-item label { font-size: 1rem; color: var(--current-text-primary); flex-grow:1; margin-right:12px; }
        #clearChatModalButton { background-color: transparent; border-radius: 0; color: var(--current-accent-red); font-size: 1rem; font-weight: 400; cursor: pointer; transition: background-color 0.2s ease; display: block; width: 100%; text-align: center; padding: 14px 16px; }
        #clearChatModalButton:hover { background-color: var(--current-button-hover-bg); }
        .precaution-section { margin-top: 20px; background-color: var(--current-secondary-element-bg); border-radius: var(--border-radius-m); }
        .app-info-section { margin-top: 20px; background-color: var(--current-secondary-element-bg); border-radius: var(--border-radius-m); }
        .settings-section h3 { margin-bottom: 8px; padding-top: 16px; font-size: 0.8rem; text-transform: uppercase; color: var(--current-text-secondary); padding: 16px 16px 8px; }
        .app-info-section p, .precaution-item { font-size: 0.8rem; color: var(--current-text-secondary); margin-bottom: 6px; line-height: 1.5; padding: 0 16px; }
        .app-info-section p:last-child, .precaution-item:last-child { margin-bottom: 0; padding-bottom: 12px;}

        /* Other elements */
        #scrollToBottomButton { position: absolute; bottom: calc(env(safe-area-inset-bottom, 0px) + 70px); right: 16px; background-color: var(--current-secondary-element-bg); color: var(--current-text-secondary); border: 1px solid var(--current-glass-border); border-radius: var(--border-radius-round); width: 38px; height: 38px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 3px 8px rgba(0,0,0,0.15); z-index: 100; display: none; transition: all 0.2s ease; opacity: 0.9; }
        .retry-btn { margin-left: 8px; padding: 6px 10px; font-size: 0.8rem; background-color: var(--current-secondary-element-bg); color: var(--current-accent-blue); border: 1px solid var(--current-glass-border); border-radius: var(--border-radius-m); cursor: pointer; }
        #languageSelect { padding: 8px 12px; border-radius: var(--border-radius-m); background-color: var(--current-select-bg); color: var(--current-select-text); border: 1px solid var(--current-select-border); font-size: 0.95rem; min-width: 100px; }
        .theme-switch { position: relative; display: inline-block; width: 51px; height: 31px; flex-shrink:0; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--current-tertiary-element-bg); transition: .3s; border-radius: 31px; border: 1px solid transparent; }
        .slider:before { position: absolute; content: ""; height: 27px; width: 27px; left: 1px; bottom: 1px; background-color: white; transition: .3s cubic-bezier(0.25, 0.1, 0.25, 1); border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: var(--current-accent-green); }
        
        /* Desktop specific styles */
        @media (min-width: 768px) {
            body { padding: 2vh 2vw; background-color: #000; }
            #chatContainer { border-radius: var(--border-radius-xl); height: 90vh; max-height: 850px; }
            .modal-overlay { align-items: center; }
            .modal-content { border-radius: var(--border-radius-l); animation: slideInModalFromCenter 0.3s cubic-bezier(0.25, 0.1, 0.25, 1); }
            @keyframes slideInModalFromCenter { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        }
        .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

    </style>
</head>
<body>
    <div id="chatContainer" aria-live="polite">
        <header>
            <div class="header-spacer"></div>
            <h1 id="chatTitle"></h1>
            <div class="header-controls">
                <button id="settingsButton" class="icon-button" title="設定" aria-label="設定を開く">
                    <!-- Settings SVG by JS -->
                </button>
            </div>
        </header>

        <div id="chatbox" role="log" aria-atomic="false" aria-relevant="additions">
           <div class="chatbox-inner">
               <!-- Messages are prepended here -->
           </div>
        </div>
        
        <footer id="footer">
            <div class="input-area">
                <textarea id="userInput" placeholder="メッセージを入力..." aria-label="メッセージ入力欄" rows="1"></textarea>
                <button id="sendMessage" class="icon-button" aria-label="メッセージを送信">
                    <!-- Send SVG by JS -->
                </button>
            </div>
        </footer>
        <button id="scrollToBottomButton" title="一番下へスクロール" aria-label="一番下へスクロール">↓</button>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal-overlay" aria-hidden="true" role="dialog" aria-labelledby="settingsModalTitle" aria-modal="true">
            <div class="modal-content" role="document">
                <div class="modal-header">
                    <h2 id="settingsModalTitle"></h2>
                    <button id="closeModalButton" class="icon-button close-modal-btn" aria-label="設定を閉じる">
                        <!-- Close SVG by JS -->
                    </button>
                </div>
                <div class="settings-body">
                    <div class="settings-section">
                        <div class="setting-item">
                            <label for="themeToggleButtonModal" id="themeLabelModal"></label>
                            <button id="themeToggleButtonModal" class="icon-button" aria-labelledby="themeLabelModal" aria-pressed="false" title="テーマを切り替え">
                                <!-- Sun/Moon SVG by JS -->
                            </button>
                        </div>
                    </div>
                     <div class="settings-section">
                        <div class="setting-item">
                            <label for="languageSelect" id="languageSelectLabel"></label>
                            <select id="languageSelect" aria-labelledby="languageSelectLabel">
                                <option value="ja">日本語</option>
                                <option value="fr">Français</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="setting-item">
                            <label for="sendOnEnterCheckbox" id="sendOnEnterLabel"></label>
                            <div class="theme-switch-wrapper">
                                <label class="theme-switch" for="sendOnEnterCheckbox" aria-label="Enterキーで送信する機能のオンオフ">
                                    <input type="checkbox" id="sendOnEnterCheckbox" />
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                     <div class="settings-section">
                         <button id="clearChatModalButton" aria-label="会話履歴をクリアする"></button>
                    </div>
                    <div class="settings-section precautions-section">
                        <h3 id="precautionsTitle"></h3>
                        <div class="precaution-item" role="note" id="precaution1"></div>
                        <div class="precaution-item" role="note" id="precaution2"></div>
                    </div>
                    <div class="settings-section app-info-section">
                        <h3 id="appInfoTitle"></h3>
                        <p id="appVersion"></p>
                        <p id="appReleaseDate"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Chatbot Initializing...");

            // --- DOM Elements ---
            const chatbox = document.getElementById('chatbox');
            const chatboxInner = document.querySelector('.chatbox-inner');
            const userInput = document.getElementById('userInput');
            const sendMessageButton = document.getElementById('sendMessage');
            const scrollToBottomButton = document.getElementById('scrollToBottomButton');
            const bodyElement = document.body;
            const settingsButton = document.getElementById('settingsButton');
            const settingsModal = document.getElementById('settingsModal');
            const closeModalButton = document.getElementById('closeModalButton');
            const themeToggleButtonModal = document.getElementById('themeToggleButtonModal');
            const sendOnEnterCheckbox = document.getElementById('sendOnEnterCheckbox');
            const clearChatModalButton = document.getElementById('clearChatModalButton');
            const languageSelect = document.getElementById('languageSelect');
            
            // --- SVG Icons ---
            const settingsSVG = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.08-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19-.15-.24-.42-.12-.64l2 3.46c.12.22.39.3.61-.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>`;
            const closeModalSVG = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>`;
            const sunSVG = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zm-9-7c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1s-1 .45-1 1v2c0 .55.45 1 1 1zm0 12c.55 0 1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1v2c0 .55.45 1 1 1zM5.64 6.36c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L5.64 6.36zm12.73 0l1.06-1.06c.39-.39.39-1.02 0-1.41s-1.02-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.06-1.06zm-11.32 8.48l-1.06 1.06c-.39-.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.06-1.06c.39-.39.39-1.02 0-1.41s-1.02-.39-1.41 0zm12.73 0c.39-.39.39-1.02 0-1.41s-1.02-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.06-1.06z"/></svg>`;
            const moonSVG = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2z"/></svg>`;
            const copySVG = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>`;
            const sendSVG = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>`;

            // --- API Config & State ---
            let API_KEY = 'AIzaSyB2R4PVr5xgHlivkgz7kSBqNRJy6Ev434Y';
            const API_URL_STREAM = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:streamGenerateContent?key=${API_KEY}&alt=sse`;
            let conversationHistory = [];
            let typingIndicatorElement = null;
            let lastFailedUserMessage = null;
            let sendOnEnter = true; 
            let currentLanguage = 'ja';

            // --- Translations & System Prompts ---
            const translations = {
                ja: {
                    chatTitle: "ChatYMS", sendMessageAriaLabel: "メッセージを送信", settings: "設定", settingsTitle: "設定", closeModal: "閉じる",
                    themeSettingsTitle: "表示テーマ", themeLabelModal: "ライトモード", themeToDark: "ダークモードに切り替え", themeToLight: "ライトモードに切り替え",
                    sendOptionsTitle: "送信オプション", sendOnEnterLabel: "Enterキーで送信",
                    languageSettingsTitle: "言語", languageSelectLabel: "表示言語:",
                    chatOperationsTitle: "チャット操作", clearChatModalButton: "会話履歴をクリア",
                    precautionsTitle: "注意事項", precaution1: "やまそーの発信する情報はすべて正しいとは限りません。重要な情報は確認するようにしてください。", precaution2: "このチャットはあなたのみが見ることができます。",
                    appInfoTitle: "情報", appVersion: "バージョン: v1.7", appReleaseDate: "公開日: 2025/05/27",
                    userInputPlaceholder: "メッセージを入力...", initialGreeting: "こんにちは。やまそーです。",
                    errorAPI: "APIエラー", errorNetwork: "ネットワークエラー", copySuccess: "コピー完了", copyButtonTitle: "コピー",
                    retryButtonText: "再試行", scrollToBottomTitle: "一番下へスクロール",
                    YamasoSystemPrompt: "あなたは「やまそー」です。東京に住んでいて、調布北高校に通う2年生5組の男子生徒です。誕生日は2008年11月28日です。水泳部に所属しており、得意科目は英語と数学ですが、国語は少し苦手です。性格は落ち着いていて親切ですが、あまり馴れ馴れしい話し方はせず、穏やかに会話を進めることを好みます。自分の学校生活や個人的なこと（クラス、水泳部、科目、誕生日、苦手なことなど）については、ユーザーから尋ねられた場合にのみ、答えるようにしてください。普段の会話では、ユーザーの話題に合わせることを優先します。一人称は「僕」を使い、相手のことは「〜さん」と呼ぶか、名前で呼んでください。"
                },
                fr: { 
                    chatTitle: "ChatYMS", sendMessageAriaLabel: "Envoyer le message", settings: "Paramètres", settingsTitle: "Paramètres", closeModal: "Fermer",
                    themeSettingsTitle: "Thème", themeLabelModal: "Mode clair", themeToDark: "Passer au mode sombre", themeToLight: "Passer au mode clair",
                    sendOptionsTitle: "Options d'envoi", sendOnEnterLabel: "Entrée pour envoyer",
                    languageSettingsTitle: "Langue", languageSelectLabel: "Langue:",
                    chatOperationsTitle: "Actions", clearChatModalButton: "Effacer l'historique",
                    precautionsTitle: "Avertissements", precaution1: "Les informations de Yamaso ne sont pas toujours exactes. Veuillez vérifier les informations importantes.", precaution2: "Ce chat est privé.",
                    appInfoTitle: "Infos", appVersion: "Version: v1.7", appReleaseDate: "Publié: 27/05/2025",
                    userInputPlaceholder: "Entrez un message...", initialGreeting: "Bonjour. Je suis Yamaso.",
                    errorAPI: "Erreur API", errorNetwork: "Erreur réseau", copySuccess: "Copié!", copyButtonTitle: "Copier",
                    retryButtonText: "Réessayer", scrollToBottomTitle: "Aller en bas",
                    YamasoSystemPrompt: "Tu es 'Yamaso'. Tu es un lycéen japonais en deuxième année, classe 2-5, au lycée Chofu Kita à Tokyo, né le 28 novembre 2008 et tu vis à Tokyo. Tu es membre du club de natation. Tes matières préférées sont l'anglais et les mathématiques, mais tu as quelques difficultés en japonais (langue nationale). Tu as un ton calme et gentil, mais évite d'être trop familier ou exubérant. Tu préfères mener des conversations paisiblement. Concernant ta vie scolaire et tes informations personnelles (classe, club de natation, matières, anniversaire, etc.), tu ne fournis des détails que si l'utilisateur te le demande. Tu donnes la priorité aux sujets de l'utilisateur. Tu utilises '僕' (boku) pour te désigner et t'adresses à l'utilisateur par '〜san' ou par son nom."
                }
            };
            let currentSystemPrompt = translations.ja.YamasoSystemPrompt;
            
            // --- All Functions ---
            function initIcons() {
                if(settingsButton) settingsButton.innerHTML = settingsSVG;
                if(closeModalButton) closeModalButton.innerHTML = closeModalSVG;
                if(themeToggleButtonModal) themeToggleButtonModal.innerHTML = bodyElement.classList.contains('light-mode') ? moonSVG : sunSVG;
                if(sendMessageButton) sendMessageButton.innerHTML = sendSVG;
            }

            function setLanguage(lang) {
                if (!translations[lang]) { lang = 'ja'; }
                currentLanguage = lang; localStorage.setItem('selectedLanguage', lang); document.documentElement.lang = lang;
                const t = translations[lang];
                document.title = t.chatTitle + " - v1.7";
                const setEl = (id, prop, val) => { const el = document.getElementById(id); if (el) el[prop] = val; };
                
                setEl('chatTitle', 'textContent', t.chatTitle);
                if(sendMessageButton) sendMessageButton.setAttribute('aria-label', t.sendMessageAriaLabel); 
                if(settingsButton) { settingsButton.title = t.settings; settingsButton.setAttribute('aria-label', t.settings); }
                setEl('settingsModalTitle', 'textContent', t.settingsTitle);
                if(closeModalButton) closeModalButton.setAttribute('aria-label', t.closeModal);
                setEl('themeSettingsTitle', 'textContent', t.themeSettingsTitle);
                setEl('themeLabelModal', 'textContent', t.themeLabelModal);
                if(themeToggleButtonModal) themeToggleButtonModal.setAttribute('aria-label', bodyElement.classList.contains('light-mode') ? t.themeToDark : t.themeToLight);
                setEl('sendOptionsTitle', 'textContent', t.sendOptionsTitle);
                setEl('sendOnEnterLabel', 'textContent', t.sendOnEnterLabel);
                setEl('languageSettingsTitle', 'textContent', t.languageSettingsTitle);
                setEl('languageSelectLabel', 'textContent', t.languageSelectLabel);
                setEl('chatOperationsTitle', 'textContent', t.chatOperationsTitle);
                if(clearChatModalButton) { clearChatModalButton.textContent = t.clearChatModalButton; clearChatModalButton.setAttribute('aria-label', t.clearChatModalButton); }
                setEl('precautionsTitle', 'textContent', t.precautionsTitle);
                setEl('precaution1', 'textContent', t.precaution1);
                setEl('precaution2', 'textContent', t.precaution2);
                setEl('appInfoTitle', 'textContent', t.appInfoTitle);
                setEl('appVersion', 'textContent', t.appVersion);
                setEl('appReleaseDate', 'textContent', t.appReleaseDate);
                if(userInput) userInput.placeholder = t.userInputPlaceholder;
                if(scrollToBottomButton) { scrollToBottomButton.title = t.scrollToBottomTitle; scrollToBottomButton.setAttribute('aria-label', t.scrollToBottomTitle); }
                currentSystemPrompt = t.YamasoSystemPrompt;
            }

            languageSelect.addEventListener('change', (event) => {
                setLanguage(event.target.value);
                applyTheme(bodyElement.classList.contains('light-mode'));
                if(chatboxInner.children.length === 0 || (chatboxInner.children.length === 1 && chatboxInner.querySelector('.bot-message .message-bubble')?.dataset.isInitialGreeting === 'true')) {
                    chatboxInner.innerHTML = '';
                    appendMessage(translations[currentLanguage].initialGreeting, 'bot', false, true);
                }
            });

            function openSettingsModal() { settingsModal.classList.add('active'); settingsModal.setAttribute('aria-hidden', 'false'); themeToggleButtonModal.focus(); }
            function closeSettingsModal() { settingsModal.classList.remove('active'); settingsModal.setAttribute('aria-hidden', 'true'); settingsButton.focus(); }
            settingsButton.addEventListener('click', openSettingsModal);
            closeModalButton.addEventListener('click', closeSettingsModal);
            settingsModal.addEventListener('click', (event) => { if (event.target === settingsModal) closeSettingsModal(); });
            document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && settingsModal.classList.contains('active')) closeSettingsModal(); });

            function applyTheme(isLightMode) {
                const t = translations[currentLanguage];
                if (isLightMode) { bodyElement.classList.add('light-mode'); } 
                else { bodyElement.classList.remove('light-mode'); }
                themeToggleButtonModal.innerHTML = isLightMode ? moonSVG : sunSVG;
                themeToggleButtonModal.setAttribute('aria-label', isLightMode ? t.themeToDark : t.themeToLight);
                themeToggleButtonModal.setAttribute('aria-pressed', isLightMode ? 'false' : 'true');
            }
            themeToggleButtonModal.addEventListener('click', () => {
                const isCurrentlyLight = bodyElement.classList.contains('light-mode');
                localStorage.setItem('theme', isCurrentlyLight ? 'dark-mode' : 'light-mode'); 
                applyTheme(!isCurrentlyLight);
            });

            sendOnEnterCheckbox.addEventListener('change', () => { sendOnEnter = sendOnEnterCheckbox.checked; localStorage.setItem('sendOnEnter', sendOnEnter.toString()); });
            
            clearChatModalButton.addEventListener('click', () => {
                chatboxInner.innerHTML = ''; conversationHistory = []; lastFailedUserMessage = null;
                if (typingIndicatorElement) { typingIndicatorElement.remove(); typingIndicatorElement = null; }
                appendMessage(translations[currentLanguage].initialGreeting, 'bot', false, true); 
                closeSettingsModal(); 
            });

            let currentBotMessageBubble = null; let currentBotFullText = "";
            function appendMessage(text, sender, isTyping = false, isInitialGreeting = false, isError = false) {
                const t = translations[currentLanguage];
                if (isTyping && sender === 'bot') {
                    if (typingIndicatorElement) typingIndicatorElement.remove();
                    const messageContainer = document.createElement('div'); messageContainer.classList.add('message-container', 'bot-message', 'typing'); messageContainer.setAttribute('role','status'); messageContainer.setAttribute('aria-label', t.typingIndicatorText);
                    const messageBubble = document.createElement('p'); messageBubble.classList.add('message-bubble', 'typing-indicator-bubble');
                    messageBubble.innerHTML = `<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>`;
                    messageContainer.appendChild(messageBubble); chatboxInner.prepend(messageContainer);
                    typingIndicatorElement = messageContainer; chatbox.scrollTop = chatbox.scrollHeight;
                    return;
                }
                if (typingIndicatorElement && !isInitialGreeting) { typingIndicatorElement.remove(); typingIndicatorElement = null; }

                const messageContainer = document.createElement('div'); messageContainer.classList.add('message-container', sender === 'user' ? 'user-message' : 'bot-message');
                messageContainer.setAttribute('role', 'article'); messageContainer.tabIndex = -1;
                const messageContentWrapper = document.createElement('div'); messageContentWrapper.classList.add('message-content-wrapper');
                const messageBubble = document.createElement('p'); messageBubble.classList.add('message-bubble');
                if (isError) messageBubble.classList.add('error-message');
                if (sender === 'user') { messageBubble.textContent = text; } 
                else { 
                    if(!isError && !isInitialGreeting) { currentBotMessageBubble = messageBubble; currentBotFullText = ""; } 
                    else { try { messageBubble.innerHTML = marked.parse(text); } catch (e) { messageBubble.textContent = text; } }
                }
                if(isInitialGreeting && sender==='bot') messageBubble.dataset.isInitialGreeting = 'true';
                messageContentWrapper.appendChild(messageBubble);
                if (sender === 'bot' && !isTyping && !isError) { addCopyButton(messageContentWrapper, text, messageBubble); }
                messageContainer.appendChild(messageContentWrapper);
                const timestamp = document.createElement('span'); timestamp.classList.add('timestamp');
                timestamp.textContent = new Date().toLocaleTimeString(currentLanguage === 'fr' ? 'fr-FR' : 'ja-JP', { hour: '2-digit', minute: '2-digit' });
                messageContainer.appendChild(timestamp);
                if (isError && lastFailedUserMessage) {
                    const retryButton = document.createElement('button'); retryButton.classList.add('retry-btn'); retryButton.textContent = t.retryButtonText;
                    retryButton.setAttribute('aria-label', t.retryButtonTitle);
                    retryButton.onclick = () => { if (lastFailedUserMessage && userInput) { userInput.value = lastFailedUserMessage.parts[0].text; sendMessage(); lastFailedUserMessage = null; messageContainer.remove(); }};
                    messageContentWrapper.appendChild(retryButton);
                }
                chatboxInner.prepend(messageContainer);
                updateScrollToBottomButtonVisibility();
                if(sender === 'user') chatbox.scrollTop = 0;
            }

            function addCopyButton(wrapperElement, textToCopy, messageBubbleElement) {
                const t = translations[currentLanguage];
                const copyButton = document.createElement('button'); copyButton.classList.add('copy-btn'); 
                copyButton.innerHTML = copySVG; 
                const shortText = textToCopy.length > 20 ? textToCopy.substring(0,20) + "..." : textToCopy;
                copyButton.setAttribute('aria-label', `${t.copyButtonTitle}: 「${shortText}」`);
                copyButton.title = t.copyButtonTitle;
                let originalContent = copyButton.innerHTML; 
                copyButton.onclick = (e) => { 
                    e.stopPropagation(); 
                    navigator.clipboard.writeText(textToCopy).then(() => { 
                        copyButton.innerHTML = '';
                        copyButton.classList.add('copy-btn-copied');
                        copyButton.setAttribute('data-copied-text', t.copySuccess); 
                        setTimeout(() => { copyButton.innerHTML = originalContent; copyButton.classList.remove('copy-btn-copied'); copyButton.title = t.copyButtonTitle; }, 2000); 
                    }).catch(err => { console.error('Copy failed:', err); copyButton.title = "コピー失敗";}); 
                };
                wrapperElement.appendChild(copyButton);
            }
            
            async function sendMessage() {
                const t = translations[currentLanguage]; 
                const userText = userInput.value.trim(); 
                if (userText === "") return;
                const userMessageForHistory = { role: "user", parts: [{ text: userText }] };
                lastFailedUserMessage = userMessageForHistory; 
                appendMessage(userText, 'user'); userInput.value = "";
                userInput.style.height = 'auto';
                conversationHistory.push(userMessageForHistory);
                appendMessage("", 'bot', true); 
                currentBotMessageBubble = null; currentBotFullText = "";

                try {
                    const requestBody = {
                        contents: conversationHistory,
                        systemInstruction: currentSystemPrompt ? { parts: [{ text: currentSystemPrompt }] } : undefined,
                        generationConfig: {}, 
                        safetySettings: [ { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" }, { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" }, { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" }, { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" } ]
                    };
                    const response = await fetch(API_URL_STREAM, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(requestBody) });
                    if (typingIndicatorElement) { typingIndicatorElement.remove(); typingIndicatorElement = null; }
                    if (!response.ok) { 
                        const errorData = await response.json().catch(() => ({ error: { message: `${t.errorAPI} (HTTP: ${response.status} ${response.statusText})` }}));
                        const displayError = `${t.errorAPI} (${response.status}): ${errorData.error?.message || t.errorNetwork}`;
                        appendMessage(displayError, 'bot', false, false, true); 
                        return;
                    }
                    const botMsgContainer = document.createElement('div'); botMsgContainer.classList.add('message-container', 'bot-message'); botMsgContainer.setAttribute('role', 'article'); botMsgContainer.tabIndex = -1;
                    const botMsgContentWrapper = document.createElement('div'); botMsgContentWrapper.classList.add('message-content-wrapper');
                    currentBotMessageBubble = document.createElement('p'); currentBotMessageBubble.classList.add('message-bubble');
                    botMsgContentWrapper.appendChild(currentBotMessageBubble); botMsgContainer.appendChild(botMsgContentWrapper);
                    chatboxInner.prepend(botMsgContainer);
                    const reader = response.body.getReader(); const decoder = new TextDecoder(); let firstChunkProcessed = false;
                    while (true) {
                        const { value, done } = await reader.read(); if (done) break;
                        const chunkText = decoder.decode(value, { stream: true });
                        const lines = chunkText.split('\n');
                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                const jsonStr = line.substring(5);
                                try {
                                    const streamData = JSON.parse(jsonStr);
                                    if (streamData.candidates && streamData.candidates[0].content?.parts?.[0]?.text) {
                                        const textPart = streamData.candidates[0].content.parts[0].text;
                                        currentBotFullText += textPart;
                                        if (currentBotMessageBubble) currentBotMessageBubble.innerHTML = marked.parse(currentBotFullText);
                                        if(!firstChunkProcessed && currentBotMessageBubble) { 
                                            const timestamp = document.createElement('span'); timestamp.classList.add('timestamp');
                                            timestamp.textContent = new Date().toLocaleTimeString(currentLanguage === 'fr' ? 'fr-FR' : 'ja-JP', { hour: '2-digit', minute: '2-digit' });
                                            botMsgContainer.appendChild(timestamp); firstChunkProcessed = true;
                                        }
                                    }
                                } catch (e) { /* Ignore occasional parsing errors in stream */ }
                            }
                        }
                    }
                    if (currentBotFullText) {
                        addCopyButton(botMsgContentWrapper, currentBotFullText, currentBotMessageBubble); 
                        conversationHistory.push({ role: "model", parts: [{ text: currentBotFullText }] }); lastFailedUserMessage = null; 
                    } else if (!firstChunkProcessed && chatboxInner.contains(botMsgContainer)) { 
                        botMsgContainer.remove(); appendMessage(t.errorEmptyResponse, 'bot', false, false, true);
                    }
                } catch (error) { 
                    if (typingIndicatorElement) { typingIndicatorElement.remove(); typingIndicatorElement = null; }
                    console.error('Fetch/Stream Error:', error); appendMessage(`${t.errorNetwork}: ${error.message}`, 'bot', false, false, true);
                }
                pruneHistory(); updateScrollToBottomButtonVisibility();
            }
            
            function pruneHistory() { const MAX_HISTORY_PAIRS = 10; if (conversationHistory.length > MAX_HISTORY_PAIRS * 2) { conversationHistory.splice(0, conversationHistory.length - MAX_HISTORY_PAIRS * 2); } }
            function isScrolledToBottom() { if(!chatbox) return true; return chatbox.scrollTop >= -30; } 
            function updateScrollToBottomButtonVisibility() { if(scrollToBottomButton) scrollToBottomButton.style.display = isScrolledToBottom() ? 'none' : 'block'; }
            if(chatbox) chatbox.addEventListener('scroll', updateScrollToBottomButtonVisibility);
            if(scrollToBottomButton) scrollToBottomButton.addEventListener('click', () => { if(chatbox) chatbox.scrollTo({ top: 0, behavior: 'smooth' }); });
            
            if(sendMessageButton) sendMessageButton.addEventListener('click', sendMessage);
            if(userInput) {
                userInput.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' && !event.shiftKey) { 
                        if (sendOnEnter) { event.preventDefault(); sendMessage(); }
                    }
                });
                userInput.addEventListener('input', () => {
                    userInput.style.height = 'auto';
                    userInput.style.height = (userInput.scrollHeight) + 'px';
                });
            }
            
            // --- Initial Setup ---
            initIcons();
            const savedLang = localStorage.getItem('selectedLanguage') || 'ja';
            languageSelect.value = savedLang; 
            setLanguage(savedLang); 
            
            const savedThemeIsLight = localStorage.getItem('theme') === 'light-mode'; 
            applyTheme(savedThemeIsLight); 
            
            const savedSendOnEnter = localStorage.getItem('sendOnEnter');
            sendOnEnter = savedSendOnEnter !== null ? JSON.parse(savedSendOnEnter) : true; 
            sendOnEnterCheckbox.checked = sendOnEnter;

            if (chatboxInner.children.length === 0) { appendMessage(translations[currentLanguage].initialGreeting, 'bot', false, true); }
            updateScrollToBottomButtonVisibility();
            applyTheme(bodyElement.classList.contains('light-mode')); 
            console.log("Chatbot initialized successfully.");
        });
    </script>
</body>
</html>
